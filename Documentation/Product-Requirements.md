# Royal Match风格三消游戏 - 产品需求文档

**项目名称**: Retro Match 2D
**目标**: 开发一款类似Royal Match的关卡制三消游戏
**当前版本**: 0.1.0 (Alpha)
**目标版本**: 1.0.0 (Release)

---

## 📋 目录

1. [产品概述](#产品概述)
2. [核心玩法](#核心玩法)
3. [开发里程碑](#开发里程碑)
4. [详细需求](#详细需求)
5. [技术架构](#技术架构)
6. [资源需求](#资源需求)

---

## 产品概述

### 游戏定位
一款轻松休闲的三消解谜游戏，玩家通过匹配宝石来完成各种关卡目标，体验丰富的道具系统和精美的视觉效果。

### 目标用户
- 休闲游戏玩家
- 三消游戏爱好者
- 年龄段：18-50岁
- 平台：PC（后期可扩展到移动端）

### 核心特色
- ✨ 丰富的特殊道具组合系统
- 🎯 多样化的关卡目标
- 🎨 精美的视觉效果和动画
- 🔧 策略性的助推器系统
- 🏆 成就和每日任务系统

---

## 核心玩法

### 基础玩法（已实现）
- ✅ 三消匹配机制（3个或更多相同宝石）
- ✅ 拖拽交换宝石
- ✅ 自动下落填充
- ✅ 连锁消除
- ✅ 基础分数系统

### 核心循环
```
开始关卡 → 查看目标 → 消除宝石 → 生成道具 → 达成目标 → 获得奖励 → 下一关卡
```

---

## 开发里程碑

### Milestone 1: 核心玩法增强（2周）
**状态**: 🟢 部分完成
**优先级**: P0（最高）

**目标**: 完善基础三消玩法，为后续功能打好基础

#### 1.1 匹配系统增强
- [ ] 支持L型和T型匹配检测
- [ ] 4连消、5连消特殊检测
- [ ] 匹配优先级系统（优先长匹配）
- [ ] 匹配预测功能

#### 1.2 动画系统
- [ ] 宝石交换动画优化（弹性效果）
- [ ] 消除动画（缩放+旋转+粒子）
- [ ] 下落动画增强（弹跳效果）
- [ ] 连锁提示动画
- [ ] 过渡动画（关卡开始/结束）

#### 1.3 性能优化
- [ ] 对象池系统（宝石复用）
- [ ] 匹配结果缓存
- [ ] 减少GC（减少临时对象创建）
- [ ] 大棋盘优化（>10x10）

**验收标准**:
- 三消玩法流畅，无卡顿
- 动画效果丰富，视觉反馈良好
- 支持至少15x15的大棋盘

---

### Milestone 2: 特殊道具系统（3周）
**状态**: 🔴 未开始
**优先级**: P0（最高）

**目标**: 实现Royal Match风格的特殊道具和组合系统

#### 2.1 基础特殊道具

##### 2.1.1 火箭（Rocket）
**生成条件**: 4连消（直线）
**效果**: 清除一整行或一整列

- [ ] 横向火箭（清除一行）
- [ ] 纵向火箭（清除一列）
- [ ] 生成逻辑实现
- [ ] 触发动画（火箭飞行+爆炸）
- [ ] 音效配置

##### 2.1.2 炸弹（Bomb）
**生成条件**: 5连消（L型或T型）
**效果**: 清除周围3x3区域

- [ ] 生成逻辑
- [ ] 爆炸范围检测（3x3）
- [ ] 爆炸动画和特效
- [ ] 连锁爆炸逻辑
- [ ] 音效配置

##### 2.1.3 TNT（大炸弹）
**生成条件**: 6连消
**效果**: 清除周围5x5区域

- [ ] 生成逻辑
- [ ] 爆炸范围检测（5x5）
- [ ] 超级爆炸动画
- [ ] 音效配置

##### 2.1.4 闪电球（Lightning Ball）
**生成条件**: 7连消
**效果**: 清除棋盘上所有相同颜色的宝石

- [ ] 生成逻辑
- [ ] 全局消除逻辑
- [ ] 闪电动画效果
- [ ] 音效配置

#### 2.2 道具组合系统

##### 组合表
| 道具1 | 道具2 | 效果 |
|------|------|------|
| 火箭 + 火箭 | 十字清除（行+列） |
| 火箭 + 炸弹 | 3条直线清除 |
| 炸弹 + 炸弹 | 7x7区域清除 |
| 炸弹 + TNT | 全屏震动，9x9清除 |
| 闪电球 + 任意颜色宝石 | 将该颜色全部转为火箭 |
| 闪电球 + 火箭 | 3个方向的火箭清除 |
| 闪电球 + 炸弹 | 随机生成多个炸弹并引爆 |

**任务清单**:
- [ ] 组合检测系统
- [ ] 组合效果实现（每种组合）
- [ ] 组合动画和特效
- [ ] 组合教学关卡
- [ ] 组合音效

#### 2.3 视觉设计
- [ ] 道具外观设计（6种道具）
- [ ] 道具Idle动画（呼吸光效）
- [ ] 道具生成特效
- [ ] 道具触发特效
- [ ] UI图标设计

**验收标准**:
- 所有道具正常生成和触发
- 道具组合系统完善
- 视觉效果华丽
- 无明显bug

**预估工作量**: 120小时

---

### Milestone 3: 关卡系统（4周）
**状态**: 🔴 未开始
**优先级**: P0（最高）

**目标**: 实现关卡目标系统、关卡编辑器和关卡管理

#### 3.1 关卡目标系统

##### 3.1.1 目标类型

**A. 分数目标**
```
目标：达到X分
例：达到10000分通关
```
- [ ] 分数目标数据结构
- [ ] 分数UI显示
- [ ] 目标达成检测
- [ ] 星级评定（1星/2星/3星）

**B. 收集目标**
```
目标：收集X个特定颜色宝石
例：收集20个红宝石、15个蓝宝石
```
- [ ] 收集计数系统
- [ ] 收集UI显示
- [ ] 多目标并行
- [ ] 目标完成动画

**C. 清除目标**
```
目标：清除X个特殊障碍物
例：清除10个冰块、5个箱子
```
- [ ] 障碍物系统（后续实现）
- [ ] 清除计数
- [ ] 目标追踪

**D. 保护目标**
```
目标：保护某些宝石不被消除
例：保护3个金币宝石到底部
```
- [ ] 保护宝石机制
- [ ] 失败条件判断
- [ ] 保护状态可视化

**E. 时间挑战**
```
目标：在60秒内达到目标
```
- [ ] 倒计时系统
- [ ] 时间UI
- [ ] 时间到失败逻辑

**F. 移动限制**
```
目标：在30步内达到目标
```
- [ ] 步数计数
- [ ] 步数UI
- [ ] 步数耗尽失败

#### 3.2 关卡数据结构

```csharp
[Serializable]
public class LevelData
{
    public int levelId;                    // 关卡ID
    public string levelName;               // 关卡名称
    public int boardWidth;                 // 棋盘宽度
    public int boardHeight;                // 棋盘高度

    // 目标设置
    public LevelGoalType goalType;         // 目标类型
    public List<LevelGoal> goals;          // 目标列表

    // 限制条件
    public int maxMoves;                   // 最大步数（0=无限制）
    public float timeLimit;                // 时间限制（0=无限制）

    // 星级标准
    public int oneStarScore;               // 1星分数
    public int twoStarScore;               // 2星分数
    public int threeStarScore;             // 3星分数

    // 棋盘设置
    public List<GemType> availableGemTypes; // 可用宝石类型
    public GemSpawnRate[] spawnRates;       // 宝石生成概率

    // 障碍物配置
    public List<ObstacleData> obstacles;    // 障碍物位置和类型

    // 特殊配置
    public bool allowShuffle;               // 允许洗牌
    public List<Vector2Int> blockedCells;   // 不可用格子
}
```

**任务清单**:
- [ ] 数据结构设计
- [ ] 序列化/反序列化
- [ ] 关卡加载系统
- [ ] 关卡进度保存

#### 3.3 关卡编辑器

**功能需求**:
- [ ] 可视化棋盘编辑器
- [ ] 拖拽放置障碍物
- [ ] 设置关卡目标
- [ ] 设置星级标准
- [ ] 关卡测试模式
- [ ] 导出/导入JSON
- [ ] 关卡模板系统

**编辑器UI**:
```
┌─────────────────────────────────────┐
│  Level Editor                       │
├─────────────────────────────────────┤
│  Level Info:                        │
│  - Level ID: [____]                 │
│  - Name: [____________]             │
│  - Size: [8] x [8]                  │
│                                     │
│  Goals:                             │
│  [+] Add Goal                       │
│  - Collect 20 Red Gems              │
│  - Reach 5000 points                │
│                                     │
│  Constraints:                       │
│  - Max Moves: [30]                  │
│  - Time Limit: [0] (unlimited)      │
│                                     │
│  Star Requirements:                 │
│  - 1 Star: [3000]                   │
│  - 2 Stars: [5000]                  │
│  - 3 Stars: [8000]                  │
│                                     │
│  [Board View]                       │
│  [Tools Panel]                      │
│  [Test] [Save] [Export]             │
└─────────────────────────────────────┘
```

#### 3.4 关卡管理器

**功能**:
- [ ] 关卡列表管理
- [ ] 关卡解锁逻辑
- [ ] 关卡进度追踪
- [ ] 关卡难度曲线
- [ ] 关卡评分系统

#### 3.5 初始关卡设计

**关卡1-10**（教学关卡）:
- 关卡1: 基础三消教学
- 关卡2: 四消生成火箭
- 关卡3: 五消生成炸弹
- 关卡4: 道具组合介绍
- 关卡5: 分数目标挑战
- 关卡6: 收集目标介绍
- 关卡7: 步数限制挑战
- 关卡8: 障碍物介绍（冰块）
- 关卡9: 多目标挑战
- 关卡10: 综合挑战

**任务清单**:
- [ ] 设计10个教学关卡
- [ ] 配置关卡数据
- [ ] 测试关卡难度
- [ ] 调整参数平衡

**验收标准**:
- 关卡系统完整可用
- 编辑器易用，可创建各种关卡
- 至少10个可玩关卡
- 目标系统运行正常

**预估工作量**: 160小时

---

### Milestone 4: 完整UI系统（3周）
**状态**: 🔴 未开始
**优先级**: P0（最高）

**目标**: 实现完整的游戏UI和用户交互流程

#### 4.1 主菜单UI

```
┌─────────────────────────────────────┐
│         [LOGO]                      │
│      Retro Match 2D                 │
│                                     │
│      [▶ Play]                       │
│      [⚙ Settings]                   │
│      [📊 Leaderboard]               │
│      [? Help]                       │
│                                     │
│      [Daily Rewards]  [Shop]        │
└─────────────────────────────────────┘
```

**任务清单**:
- [ ] 主菜单场景设计
- [ ] Logo动画
- [ ] 按钮交互和音效
- [ ] 背景动画效果
- [ ] 设置面板

#### 4.2 关卡地图UI

**参考Royal Match的地图风格**:
```
关卡路径展示（类似地图）
┌─────────────────────────────────────┐
│     🏰                              │
│      ↓                              │
│    [10]← 当前                       │
│      ↓                              │
│    [9]✓ (3⭐)                       │
│      ↓                              │
│    [8]✓ (2⭐)                       │
│      ↓                              │
│    [7]✓ (3⭐)                       │
│     ...                             │
│                                     │
│  [Lives: ❤❤❤❤❤]  [Coins: 1250]   │
└─────────────────────────────────────┘
```

**功能需求**:
- [ ] 滚动地图视图
- [ ] 关卡节点显示
- [ ] 关卡状态标识（未解锁/已完成/当前）
- [ ] 星级显示
- [ ] 章节分隔
- [ ] 角色移动动画
- [ ] 地图主题切换

#### 4.3 关卡内UI

**游戏中HUD**:
```
┌─────────────────────────────────────┐
│ [Back]  Level 5  [Pause] [⚙]       │
│                                     │
│ 目标：                              │
│ 🔴 收集20个  [████████░░] 12/20    │
│ 🔵 收集15个  [██████████] 15/15 ✓  │
│                                     │
│ 移动数: 25                          │
│ 分数: 8,450  ⭐⭐⭐                 │
│                                     │
│ [助推器栏]                          │
│ [🔨] [🔄] [🌟] [+5]                │
│                                     │
│        [Game Board]                 │
│                                     │
└─────────────────────────────────────┘
```

**任务清单**:
- [ ] HUD布局设计
- [ ] 目标进度条
- [ ] 步数/分数实时更新
- [ ] 星级进度指示器
- [ ] 助推器按钮
- [ ] 暂停菜单
- [ ] 设置面板

#### 4.4 弹窗系统

##### 4.4.1 关卡开始弹窗
```
┌─────────────────────────────────────┐
│          Level 5                    │
│                                     │
│  目标：                             │
│  🔴 收集 20个红宝石                 │
│  🔵 收集 15个蓝宝石                 │
│                                     │
│  移动数：30                         │
│                                     │
│  [开始游戏]                         │
└─────────────────────────────────────┘
```

##### 4.4.2 关卡完成弹窗
```
┌─────────────────────────────────────┐
│        🎉 恭喜过关！ 🎉             │
│                                     │
│           ⭐⭐⭐                    │
│                                     │
│  得分: 12,450                       │
│  奖励金币: +100 💰                  │
│                                     │
│  [下一关]  [重玩]  [返回]          │
└─────────────────────────────────────┘
```

##### 4.4.3 关卡失败弹窗
```
┌─────────────────────────────────────┐
│        😢 差一点！                  │
│                                     │
│  目标未完成                         │
│  🔴 12/20 (还差8个)                 │
│                                     │
│  [💎 +5步 (50金币)]                │
│  [重试]  [返回]                     │
└─────────────────────────────────────┘
```

**任务清单**:
- [ ] 通用弹窗框架
- [ ] 关卡开始弹窗
- [ ] 关卡胜利弹窗
- [ ] 关卡失败弹窗
- [ ] 暂停弹窗
- [ ] 设置弹窗
- [ ] 确认弹窗
- [ ] 奖励领取弹窗

#### 4.5 动画和过渡

**需求**:
- [ ] 场景切换动画
- [ ] 弹窗进入/退出动画
- [ ] UI元素缓动动画
- [ ] 数字变化动画（分数、金币）
- [ ] 列表项展开/折叠动画

#### 4.6 多语言支持

**支持语言**:
- [ ] 简体中文
- [ ] 英文
- [ ] 其他语言（可选）

**任务**:
- [ ] 本地化框架
- [ ] 字符串表
- [ ] 语言切换功能
- [ ] 字体支持

**验收标准**:
- UI完整美观
- 交互流畅
- 所有弹窗正常工作
- 支持至少中英文

**预估工作量**: 120小时

---

### Milestone 5: 助推器与商店系统（2周）
**状态**: 🔴 未开始
**优先级**: P1（高）

**目标**: 实现助推器、金币系统和内购商店

#### 5.1 助推器系统

##### 5.1.1 助推器类型

**开局助推器**（关卡开始前使用）:

1. **🔨 锤子（Hammer）**
   - 功能：消除任意1个宝石
   - 价格：100金币
   - [ ] 实现锤子选择UI
   - [ ] 单个宝石消除逻辑
   - [ ] 动画效果

2. **🔄 洗牌（Shuffle）**
   - 功能：重新排列棋盘宝石
   - 价格：150金币
   - [ ] 洗牌算法
   - [ ] 确保洗牌后有可行解
   - [ ] 动画效果

3. **🌟 开局道具（Starting Power）**
   - 功能：开局获得3个随机特殊道具
   - 价格：200金币
   - [ ] 随机道具生成
   - [ ] 道具位置分配
   - [ ] 动画展示

4. **+5 额外移动（+5 Moves）**
   - 功能：增加5步移动次数
   - 价格：80金币
   - [ ] 步数增加逻辑
   - [ ] UI更新
   - [ ] 动画提示

**游戏内助推器**（游戏进行中使用）:

1. **🎯 瞄准器（Aim）**
   - 功能：显示最佳消除提示
   - 冷却时间：3步
   - [ ] 最佳移动计算
   - [ ] 高亮显示
   - [ ] 冷却计时

2. **💣 手榴弹（Grenade）**
   - 功能：炸毁3x3区域
   - 价格：150金币/使用
   - [ ] 区域选择UI
   - [ ] 爆炸效果
   - [ ] 逻辑实现

**任务清单**:
- [ ] 助推器数据结构
- [ ] 助推器管理器
- [ ] 助推器使用逻辑
- [ ] 助推器UI
- [ ] 助推器音效

#### 5.2 货币系统

**货币类型**:
1. **金币（Coins）** - 软货币
   - 游戏内获得
   - 用于购买助推器
   - [ ] 金币管理系统
   - [ ] 金币显示UI
   - [ ] 金币动画

2. **钻石（Gems）** - 硬货币
   - 内购获得
   - 可兑换金币
   - [ ] 钻石管理系统
   - [ ] 钻石显示UI
   - [ ] 钻石动画

**获取途径**:
- 完成关卡奖励
- 每日签到
- 完成任务
- 观看广告（可选）
- 内购

**任务清单**:
- [ ] 货币数据结构
- [ ] 货币管理器
- [ ] 存储和加载
- [ ] 交易系统
- [ ] 货币UI

#### 5.3 商店系统

**商店页面布局**:
```
┌─────────────────────────────────────┐
│         💰 商店                     │
├─────────────────────────────────────┤
│  [助推器] [金币包] [钻石包]         │
├─────────────────────────────────────┤
│  助推器：                           │
│  ┌──────────┐ ┌──────────┐         │
│  │ 🔨 锤子   │ │ 🔄 洗牌   │         │
│  │ x5       │ │ x3       │         │
│  │ 300💰    │ │ 400💰    │         │
│  └─[购买]───┘ └─[购买]───┘         │
│                                     │
│  金币包：                           │
│  ┌──────────┐ ┌──────────┐         │
│  │ 💰袋      │ │ 💰箱      │         │
│  │ 1000金币  │ │ 5000金币  │         │
│  │ 💎50     │ │ 💎200    │         │
│  └─[购买]───┘ └─[购买]───┘         │
└─────────────────────────────────────┘
```

**功能需求**:
- [ ] 商店UI设计
- [ ] 商品列表
- [ ] 购买确认
- [ ] 购买动画
- [ ] 交易记录
- [ ] 特惠活动标签

#### 5.4 生命值系统

**机制**:
- 最大生命值：5个❤
- 失败关卡消耗1个❤
- 生命值恢复：30分钟恢复1个
- 可以通过好友赠送获得
- 可以通过金币/钻石购买

**任务清单**:
- [ ] 生命值管理系统
- [ ] 生命值UI显示
- [ ] 生命值恢复计时器
- [ ] 生命值不足提示
- [ ] 购买生命值弹窗

**验收标准**:
- 助推器系统完整可用
- 商店功能正常
- 货币系统稳定
- 生命值机制正确

**预估工作量**: 80小时

---

### Milestone 6: 障碍物与特殊元素（2周）
**状态**: 🔴 未开始
**优先级**: P1（高）

**目标**: 增加游戏深度，实现各种障碍物和特殊元素

#### 6.1 障碍物类型

##### 6.1.1 冰块（Ice）
**特性**:
- 占据一个格子
- 需要消除1次相邻宝石才能破坏
- 分为1层、2层、3层冰块

**任务**:
- [ ] 冰块数据结构
- [ ] 冰块渲染
- [ ] 破坏逻辑（层级递减）
- [ ] 破坏动画
- [ ] 音效

##### 6.1.2 箱子（Box）
**特性**:
- 占据一个格子，阻挡宝石下落
- 需要消除2次相邻宝石才能破坏
- 不可移动

**任务**:
- [ ] 箱子数据结构
- [ ] 箱子渲染
- [ ] 破坏计数
- [ ] 破坏动画
- [ ] 音效

##### 6.1.3 链条（Chain）
**特性**:
- 锁住宝石，不能移动
- 需要消除该宝石才能解锁
- 可配置链条层数

**任务**:
- [ ] 链条数据结构
- [ ] 链条渲染（覆盖在宝石上）
- [ ] 锁定逻辑
- [ ] 解锁动画
- [ ] 音效

##### 6.1.4 宝箱（Treasure）
**特性**:
- 需要移动到棋盘底部收集
- 不能被消除
- 可下落

**任务**:
- [ ] 宝箱数据结构
- [ ] 下落逻辑
- [ ] 收集检测
- [ ] 收集动画
- [ ] 音效

##### 6.1.5 传送门（Portal）
**特性**:
- 成对出现
- 宝石可以从一个传送门进入，从另一个出来

**任务**:
- [ ] 传送门数据结构
- [ ] 传送逻辑
- [ ] 传送动画
- [ ] 音效

##### 6.1.6 泡泡（Bubble）
**特性**:
- 包裹宝石
- 需要消除2次才能释放内部宝石
- 释放后宝石可正常使用

**任务**:
- [ ] 泡泡数据结构
- [ ] 泡泡渲染（半透明覆盖）
- [ ] 破裂逻辑
- [ ] 破裂动画
- [ ] 音效

##### 6.1.7 墙壁（Wall）
**特性**:
- 完全阻挡，无法破坏
- 用于制造特殊形状的棋盘

**任务**:
- [ ] 墙壁数据结构
- [ ] 墙壁渲染
- [ ] 阻挡逻辑

#### 6.2 特殊宝石

##### 6.2.1 彩虹宝石（Rainbow Gem）
**生成**:
- 7连消或更多
- 可以匹配任何颜色

**任务**:
- [ ] 彩虹宝石数据
- [ ] 万能匹配逻辑
- [ ] 特殊效果
- [ ] 动画

##### 6.2.2 金币宝石（Coin Gem）
**生成**:
- 关卡随机生成
- 需要移动到底部收集

**任务**:
- [ ] 金币宝石数据
- [ ] 收集逻辑
- [ ] 收集动画
- [ ] 奖励发放

#### 6.3 障碍物管理系统

**任务**:
- [ ] 障碍物工厂模式
- [ ] 障碍物管理器
- [ ] 障碍物与宝石交互
- [ ] 障碍物状态保存
- [ ] 障碍物编辑器工具

**验收标准**:
- 所有障碍物类型实现
- 障碍物交互正确
- 视觉效果良好
- 可在编辑器中配置

**预估工作量**: 80小时

---

### Milestone 7: 进度与社交系统（2周）
**状态**: 🔴 未开始
**优先级**: P2（中）

**目标**: 实现玩家进度保存、成就系统和社交功能

#### 7.1 数据持久化

**存储内容**:
- [ ] 玩家基本信息（昵称、头像）
- [ ] 关卡进度（已解锁、星级、最高分）
- [ ] 货币（金币、钻石）
- [ ] 助推器库存
- [ ] 生命值和恢复时间
- [ ] 成就进度
- [ ] 每日任务进度
- [ ] 设置选项

**技术方案**:
- [ ] 本地存储（PlayerPrefs/JSON）
- [ ] 云存储（可选）
- [ ] 数据加密
- [ ] 版本迁移

**任务**:
- [ ] 存档系统架构
- [ ] 保存/加载接口
- [ ] 数据加密
- [ ] 存档备份

#### 7.2 成就系统

**成就类型**:

**进度成就**:
- 完成10/50/100/500关
- 获得100/500/1000颗三星
- 收集10000/50000/100000个宝石

**技巧成就**:
- 单次消除30/50/100个宝石
- 连续5/10/20关三星通过
- 使用道具组合10/50/100次

**收集成就**:
- 生成100/500/1000个火箭
- 生成100/500个炸弹
- 使用闪电球50/100次

**任务清单**:
- [ ] 成就数据结构
- [ ] 成就跟踪系统
- [ ] 成就解锁检测
- [ ] 成就UI页面
- [ ] 成就奖励发放
- [ ] 成就通知

#### 7.3 每日任务

**任务类型**:
- 完成3/5/10关
- 收集100/200个特定颜色宝石
- 生成10个特殊道具
- 使用5次助推器
- 达到累计分数

**任务清单**:
- [ ] 任务数据结构
- [ ] 任务生成系统
- [ ] 任务进度跟踪
- [ ] 任务UI
- [ ] 任务奖励
- [ ] 每日刷新

#### 7.4 每日签到

**功能**:
```
┌─────────────────────────────────────┐
│       📅 每日签到                   │
├─────────────────────────────────────┤
│  周一  周二  周三  周四  周五  周六  周日│
│  [✓]  [✓]  [●]  [ ]  [ ]  [ ]  [ ]│
│  100💰 150💰 200💰 🔨  300💰 💎10 🎁│
├─────────────────────────────────────┤
│     连续签到3天，获得额外奖励！      │
│          [立即签到]                 │
└─────────────────────────────────────┘
```

**任务**:
- [ ] 签到系统
- [ ] 签到UI
- [ ] 奖励配置
- [ ] 连续签到奖励
- [ ] 补签功能（可选）

#### 7.5 排行榜（可选）

**类型**:
- 全局排行榜
- 好友排行榜
- 每周排行榜

**任务**:
- [ ] 排行榜数据结构
- [ ] 排行榜UI
- [ ] 分数上传
- [ ] 排名查询

#### 7.6 社交功能（可选）

**功能**:
- [ ] 好友系统
- [ ] 赠送生命值
- [ ] 好友排行
- [ ] 分享功能

**验收标准**:
- 数据保存可靠
- 成就系统完整
- 每日任务正常运作
- 签到系统稳定

**预估工作量**: 80小时

---

### Milestone 8: 视觉与音效打磨（2周）
**状态**: 🔴 未开始
**优先级**: P2（中）

**目标**: 提升游戏视觉效果和音效体验

#### 8.1 视觉效果

##### 8.1.1 粒子特效
- [ ] 宝石消除粒子
- [ ] 道具触发粒子
- [ ] 连锁消除粒子
- [ ] 关卡完成粒子
- [ ] UI交互粒子

##### 8.1.2 Shader特效
- [ ] 宝石光泽shader
- [ ] 选中高亮shader
- [ ] 特殊道具发光shader
- [ ] 冰块冰霜shader
- [ ] 过渡特效shader

##### 8.1.3 UI特效
- [ ] 按钮按下效果
- [ ] 弹窗缩放动画
- [ ] 数字跳动效果
- [ ] 进度条填充动画
- [ ] 星星闪烁效果

**任务清单**:
- [ ] 特效资源制作
- [ ] 特效系统集成
- [ ] 性能优化
- [ ] 特效管理器

#### 8.2 音效系统

##### 8.2.1 音效类型

**UI音效**:
- [ ] 按钮点击音效
- [ ] 弹窗打开/关闭音效
- [ ] 胜利音效
- [ ] 失败音效
- [ ] 获得奖励音效

**游戏音效**:
- [ ] 宝石选中音效
- [ ] 宝石交换音效
- [ ] 宝石消除音效（不同颜色不同音调）
- [ ] 连锁消除音效（音调递增）
- [ ] 道具生成音效
- [ ] 道具触发音效
- [ ] 障碍物破坏音效

**背景音乐**:
- [ ] 主菜单音乐
- [ ] 关卡地图音乐
- [ ] 游戏内音乐（多首，随机播放）
- [ ] 胜利音乐
- [ ] 失败音乐

##### 8.2.2 音效管理

**功能**:
- [ ] 音效管理器
- [ ] 音量控制（BGM/SFX分离）
- [ ] 音效池（避免重复加载）
- [ ] 音效淡入淡出
- [ ] 静音选项

**任务清单**:
- [ ] 音效资源收集/制作
- [ ] 音效系统实现
- [ ] 音量设置
- [ ] 音效测试

#### 8.3 主题美化

**场景美化**:
- [ ] 主菜单背景
- [ ] 关卡地图背景（多主题）
- [ ] 游戏棋盘背景
- [ ] UI装饰元素

**宝石美化**:
- [ ] 高清宝石素材
- [ ] 宝石Idle动画
- [ ] 宝石特效优化

**任务清单**:
- [ ] 美术资源制作
- [ ] UI重新设计
- [ ] 整体视觉风格统一

**验收标准**:
- 视觉效果华丽
- 音效丰富有层次
- 整体风格统一
- 性能稳定

**预估工作量**: 80小时

---

### Milestone 9: 高级功能与优化（1-2周）
**状态**: 🔴 未开始
**优先级**: P3（低）

**目标**: 添加高级功能，优化用户体验

#### 9.1 高级关卡元素

##### 9.1.1 动态元素
- [ ] 传送带（移动宝石）
- [ ] 旋转器（改变宝石位置）
- [ ] 陷阱（定时破坏宝石）

##### 9.1.2 Boss关卡
- [ ] Boss角色设计
- [ ] Boss血条
- [ ] Boss技能
- [ ] 特殊胜利条件

#### 9.2 活动系统

**活动类型**:
- [ ] 限时挑战（特殊关卡）
- [ ] 双倍金币活动
- [ ] 限时折扣
- [ ] 节日活动

**任务**:
- [ ] 活动配置系统
- [ ] 活动UI
- [ ] 活动奖励
- [ ] 活动计时器

#### 9.3 教程系统

**功能**:
- [ ] 新手引导（蒙层高亮）
- [ ] 强制教程关卡
- [ ] 帮助页面
- [ ] 提示系统

**任务**:
- [ ] 引导系统框架
- [ ] 引导步骤配置
- [ ] 蒙层UI
- [ ] 引导动画

#### 9.4 性能优化

**优化项**:
- [ ] 内存优化
- [ ] 加载时间优化
- [ ] 帧率优化
- [ ] 包体大小优化
- [ ] 电池消耗优化

**任务**:
- [ ] 性能分析
- [ ] 瓶颈识别
- [ ] 优化实施
- [ ] 测试验证

#### 9.5 数据分析

**埋点数据**:
- [ ] 关卡通过率
- [ ] 关卡平均尝试次数
- [ ] 助推器使用率
- [ ] 玩家留存
- [ ] 货币消耗/获取

**任务**:
- [ ] 埋点系统
- [ ] 数据上报
- [ ] 数据分析工具

**验收标准**:
- 高级功能稳定
- 性能达标
- 数据收集正常

**预估工作量**: 40-80小时

---

## 技术架构

### 核心系统架构

```
┌─────────────────────────────────────────────────┐
│                  Game Manager                   │
│           (游戏总控制器，协调各系统)              │
└────────────────┬────────────────────────────────┘
                 │
    ┌────────────┼────────────┬────────────┐
    │            │            │            │
    ▼            ▼            ▼            ▼
┌────────┐  ┌────────┐  ┌────────┐  ┌─────────┐
│ Level  │  │ Match  │  │  UI    │  │ Audio   │
│Manager │  │Manager │  │Manager │  │ Manager │
└────────┘  └────────┘  └────────┘  └─────────┘
    │            │            │            │
    ▼            ▼            ▼            ▼
┌────────┐  ┌────────┐  ┌────────┐  ┌─────────┐
│ Level  │  │Special │  │Booster │  │Currency │
│ Data   │  │ Item   │  │Manager │  │ Manager │
└────────┘  └────────┘  └────────┘  └─────────┘
                 │
    ┌────────────┼────────────┐
    │            │            │
    ▼            ▼            ▼
┌────────┐  ┌────────┐  ┌────────┐
│Obstacle│  │ Power  │  │ Gem    │
│Manager │  │  Up    │  │ Pool   │
└────────┘  └────────┘  └────────┘
```

### 数据流

```
用户输入 → InputController → GameManager
    ↓
MatchDetector → SpecialItemManager → EffectManager
    ↓
ScoreManager → LevelManager → UIManager
    ↓
SaveManager → 数据持久化
```

---

## 资源需求

### 美术资源

**2D素材**:
- 宝石（6种颜色，每种3帧动画）
- 特殊道具（火箭、炸弹、TNT、闪电球等）
- 障碍物（冰块、箱子、链条等）
- UI元素（按钮、背景、图标）
- 角色（可选）

**特效**:
- 粒子特效（20-30个）
- Shader特效（5-10个）

**预估**: 200-300个素材文件

### 音效资源

**音效**: 50-80个音效文件
**音乐**: 5-10首背景音乐

### 字体

- 主字体（中文）
- 英文字体
- 数字字体（分数显示）

---

## 开发时间规划

| 里程碑 | 预计时间 | 人力 | 总工时 |
|-------|---------|-----|-------|
| M1: 核心玩法增强 | 2周 | 1人 | 80h |
| M2: 特殊道具系统 | 3周 | 1人 | 120h |
| M3: 关卡系统 | 4周 | 1人 | 160h |
| M4: 完整UI系统 | 3周 | 1人 | 120h |
| M5: 助推器与商店 | 2周 | 1人 | 80h |
| M6: 障碍物系统 | 2周 | 1人 | 80h |
| M7: 进度与社交 | 2周 | 1人 | 80h |
| M8: 视觉音效 | 2周 | 1人 | 80h |
| M9: 高级功能 | 1-2周 | 1人 | 40-80h |
| **总计** | **21-22周** | **1人** | **840-920h** |

**说明**:
- 以上时间为单人全职开发估算
- 如果有美术、音效支持，可并行进行
- 实际开发中会有测试、修改、优化时间

---

## 优先级说明

- **P0（最高）**: 核心功能，必须实现
- **P1（高）**: 重要功能，显著提升游戏性
- **P2（中）**: 增值功能，提升用户体验
- **P3（低）**: 锦上添花，可后期迭代

---

## 版本规划

### v0.2.0 (MVP)
- M1 + M2 + M3部分
- 可玩的基础版本

### v0.5.0 (Alpha)
- M1-M5
- 完整核心功能

### v0.8.0 (Beta)
- M1-M7
- 接近完整版本

### v1.0.0 (Release)
- M1-M9
- 正式发布版本

---

**文档版本**: 1.0
**创建日期**: 2026年1月16日
**最后更新**: 2026年1月16日
